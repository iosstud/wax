<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-orchestrator/unified-search" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Unified Search | Wax</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wax.dev/docs/orchestrator/unified-search"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Unified Search | Wax"><meta data-rh="true" name="description" content="Fuse BM25, vector, structured memory, and timeline results with reciprocal rank fusion."><meta data-rh="true" property="og:description" content="Fuse BM25, vector, structured memory, and timeline results with reciprocal rank fusion."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wax.dev/docs/orchestrator/unified-search"><link data-rh="true" rel="alternate" href="https://wax.dev/docs/orchestrator/unified-search" hreflang="en"><link data-rh="true" rel="alternate" href="https://wax.dev/docs/orchestrator/unified-search" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Unified Search","item":"https://wax.dev/docs/orchestrator/unified-search"}]}</script><link rel="stylesheet" href="/assets/css/styles.986be227.css">
<script src="/assets/js/runtime~main.13c8a650.js" defer="defer"></script>
<script src="/assets/js/main.11dcacc2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","dark"),document.documentElement.setAttribute("data-theme-choice","dark"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Wax</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/christopherkarani/Wax" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro"><span title="Getting Started" class="linkLabel_WmDU">Getting Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/architecture"><span title="Architecture" class="linkLabel_WmDU">Architecture</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/orchestrator/memory-orchestrator"><span title="Orchestrator" class="categoryLinkLabel_W154">Orchestrator</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/orchestrator/memory-orchestrator"><span title="Memory Orchestrator" class="linkLabel_WmDU">Memory Orchestrator</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/orchestrator/rag-pipeline"><span title="RAG Pipeline" class="linkLabel_WmDU">RAG Pipeline</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/orchestrator/unified-search"><span title="Unified Search" class="linkLabel_WmDU">Unified Search</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/orchestrator/session-management"><span title="Session Management" class="linkLabel_WmDU">Session Management</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/media/photo-rag"><span title="Media RAG" class="categoryLinkLabel_W154">Media RAG</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/core/getting-started"><span title="WaxCore" class="categoryLinkLabel_W154">WaxCore</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/text-search/text-search-engine"><span title="Text Search" class="categoryLinkLabel_W154">Text Search</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/vector-search/vector-search-engines"><span title="Vector Search" class="categoryLinkLabel_W154">Vector Search</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/mini-lm/mini-lm-embedder"><span title="MiniLM Embedder" class="categoryLinkLabel_W154">MiniLM Embedder</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Orchestrator</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Unified Search</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Unified Search</h1></header><p>Fuse BM25, vector, structured memory, and timeline results with reciprocal rank fusion.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>Wax&#x27;s unified search runs multiple search strategies in parallel and fuses their results using reciprocal rank fusion (RRF). This hybrid approach combines the precision of keyword search with the recall of semantic search.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="search-lanes">Search Lanes<a href="#search-lanes" class="hash-link" aria-label="Direct link to Search Lanes" title="Direct link to Search Lanes" translate="no">​</a></h2>
<p>Each search request can activate up to four lanes:</p>
<table><thead><tr><th>Lane</th><th>Engine</th><th>Best For</th></tr></thead><tbody><tr><td><strong>Text (BM25)</strong></td><td><code>FTS5SearchEngine</code></td><td>Exact keyword matches, names, codes</td></tr><tr><td><strong>Vector</strong></td><td><code>VectorSearchEngine</code></td><td>Semantic similarity, paraphrased queries</td></tr><tr><td><strong>Structured Memory</strong></td><td>Entity/fact queries</td><td>Known entities and relationships</td></tr><tr><td><strong>Timeline</strong></td><td>Reverse chronological</td><td>&quot;Recent&quot; and &quot;latest&quot; queries</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="text-lane">Text Lane<a href="#text-lane" class="hash-link" aria-label="Direct link to Text Lane" title="Direct link to Text Lane" translate="no">​</a></h3>
<p>Runs an FTS5 MATCH query with BM25 scoring. If the primary query returns insufficient results, a fallback OR-expanded query broadens the search.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="vector-lane">Vector Lane<a href="#vector-lane" class="hash-link" aria-label="Direct link to Vector Lane" title="Direct link to Vector Lane" translate="no">​</a></h3>
<p>Computes the cosine similarity between the query embedding and all indexed frame embeddings. Requires an <code>EmbeddingProvider</code> to be configured.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="structured-memory-lane">Structured Memory Lane<a href="#structured-memory-lane" class="hash-link" aria-label="Direct link to Structured Memory Lane" title="Direct link to Structured Memory Lane" translate="no">​</a></h3>
<p>Resolves entity mentions in the query, finds related facts, and retrieves evidence frames. This lane surfaces frames that are semantically connected through the knowledge graph.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="timeline-lane">Timeline Lane<a href="#timeline-lane" class="hash-link" aria-label="Direct link to Timeline Lane" title="Direct link to Timeline Lane" translate="no">​</a></h3>
<p>A reverse-chronological fallback activated for queries that imply recency (e.g., &quot;what happened recently?&quot;). This ensures temporal queries return results even when keyword/vector matches are sparse.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="reciprocal-rank-fusion-rrf">Reciprocal Rank Fusion (RRF)<a href="#reciprocal-rank-fusion-rrf" class="hash-link" aria-label="Direct link to Reciprocal Rank Fusion (RRF)" title="Direct link to Reciprocal Rank Fusion (RRF)" translate="no">​</a></h2>
<p>Results from all active lanes are merged using RRF:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">score(d) = Σ (weight_lane / (rrfK + rank_lane(d)))</span><br></span></code></pre></div></div>
<p>Where:</p>
<ul>
<li class=""><code>rrfK</code> is a smoothing constant (default 60)</li>
<li class=""><code>weight_lane</code> is the per-lane weight from the adaptive fusion config</li>
<li class=""><code>rank_lane(d)</code> is the document&#x27;s rank in that lane (1-based)</li>
</ul>
<p>RRF is robust to score scale differences between lanes and naturally handles documents that appear in multiple lanes.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="query-classification">Query Classification<a href="#query-classification" class="hash-link" aria-label="Direct link to Query Classification" title="Direct link to Query Classification" translate="no">​</a></h2>
<p>The <code>RuleBasedQueryClassifier</code> categorizes queries to adjust fusion weights:</p>
<table><thead><tr><th>Type</th><th>Triggers</th><th>Weight Adjustment</th></tr></thead><tbody><tr><td>Factual</td><td>&quot;what is&quot;, &quot;who is&quot;, &quot;define&quot;</td><td>Higher BM25 weight</td></tr><tr><td>Semantic</td><td>&quot;how&quot;, &quot;why&quot;, &quot;explain&quot;</td><td>Higher vector weight</td></tr><tr><td>Temporal</td><td>&quot;when&quot;, &quot;recent&quot;, &quot;yesterday&quot;</td><td>Include timeline lane</td></tr><tr><td>Exploratory</td><td>Default</td><td>Balanced weights</td></tr></tbody></table>
<p>Classification is fully offline -- no ML models or network calls required.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="search-request">Search Request<a href="#search-request" class="hash-link" aria-label="Direct link to Search Request" title="Direct link to Search Request" translate="no">​</a></h2>
<p>Configure searches with <code>SearchRequest</code>:</p>
<div class="language-swift codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-swift codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">let</span><span class="token plain"> request </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">SearchRequest</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;quarterly roadmap&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    embedding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> queryEmbedding</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// Optional</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    mode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">hybrid</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">alpha</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0.5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain">     </span><span class="token comment" style="color:rgb(106, 153, 85)">// 0 = vector only, 1 = text only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    topK</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    rrfK</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">let</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> session</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">search</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="search-modes">Search Modes<a href="#search-modes" class="hash-link" aria-label="Direct link to Search Modes" title="Direct link to Search Modes" translate="no">​</a></h3>
<p><code>SearchMode</code> controls which lanes are active:</p>
<table><thead><tr><th>Mode</th><th>Active Lanes</th></tr></thead><tbody><tr><td><code>.textOnly</code></td><td>BM25 only</td></tr><tr><td><code>.vectorOnly</code></td><td>Vector only</td></tr><tr><td><code>.hybrid(alpha: Float)</code></td><td>Both BM25 and vector, blended by alpha</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="frame-filtering">Frame Filtering<a href="#frame-filtering" class="hash-link" aria-label="Direct link to Frame Filtering" title="Direct link to Frame Filtering" translate="no">​</a></h3>
<p>Restrict results with metadata predicates:</p>
<div class="language-swift codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-swift codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> filter </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">FrameFilter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">requiredTags </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;meetings&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">requiredLabels </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;important&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">timeRange </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">TimeRange</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">after</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> lastWeekMs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> before</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nowMs</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">includeDeleted </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">filter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">includeSuperseded </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">let</span><span class="token plain"> request </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">SearchRequest</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;standup notes&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    frameFilter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> filter</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="structured-memory-options">Structured Memory Options<a href="#structured-memory-options" class="hash-link" aria-label="Direct link to Structured Memory Options" title="Direct link to Structured Memory Options" translate="no">​</a></h3>
<p>Fine-tune the structured memory lane:</p>
<div class="language-swift codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-swift codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> smOptions </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">StructuredMemorySearchOptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">smOptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">weight </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">smOptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">maxEntityCandidates </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">smOptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">maxFacts </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">smOptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">maxEvidenceFrames </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">smOptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">requireEvidenceSpan </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">false</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="search-response">Search Response<a href="#search-response" class="hash-link" aria-label="Direct link to Search Response" title="Direct link to Search Response" translate="no">​</a></h2>
<p><code>SearchResponse</code> contains ranked results with source attribution:</p>
<div class="language-swift codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-swift codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> result </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">results </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;Frame </span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">\(</span><span class="token string-literal interpolation">result</span><span class="token string-literal interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string-literal interpolation">frameId</span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">: </span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">\(</span><span class="token string-literal interpolation">result</span><span class="token string-literal interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string-literal interpolation">score</span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;Sources: </span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">\(</span><span class="token string-literal interpolation">result</span><span class="token string-literal interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string-literal interpolation">sources</span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// [.text, .vector, ...]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;Preview: </span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">\(</span><span class="token string-literal interpolation">result</span><span class="token string-literal interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string-literal interpolation">previewText </span><span class="token string-literal interpolation operator" style="color:rgb(212, 212, 212)">??</span><span class="token string-literal interpolation"> </span><span class="token string-literal interpolation string-literal string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div>
<p>Each result reports which lanes contributed via the <code>sources</code> array:</p>
<ul>
<li class=""><code>.text</code> -- Matched in BM25 lane</li>
<li class=""><code>.vector</code> -- Matched in vector lane</li>
<li class=""><code>.timeline</code> -- From timeline fallback</li>
<li class=""><code>.structuredMemory</code> -- Surfaced via knowledge graph</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ranking-diagnostics">Ranking Diagnostics<a href="#ranking-diagnostics" class="hash-link" aria-label="Direct link to Ranking Diagnostics" title="Direct link to Ranking Diagnostics" translate="no">​</a></h3>
<p>Enable diagnostics for debugging:</p>
<div class="language-swift codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-swift codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">var</span><span class="token plain"> request </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(78, 201, 176)">SearchRequest</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;test&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">request</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">enableRankingDiagnostics </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">request</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">rankingDiagnosticsTopK </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">let</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">try</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">await</span><span class="token plain"> session</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token function" style="color:rgb(220, 220, 170)">search</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> result </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">results </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">let</span><span class="token plain"> diag </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">rankingDiagnostics </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;Best lane rank: </span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">\(</span><span class="token string-literal interpolation">diag</span><span class="token string-literal interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string-literal interpolation">bestLaneRank</span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;Contributions: </span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">\(</span><span class="token string-literal interpolation">diag</span><span class="token string-literal interpolation punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token string-literal interpolation">laneContributions</span><span class="token string-literal interpolation-punctuation punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token string-literal string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/christopherkarani/Wax/tree/main/website/docs/orchestrator/unified-search.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/orchestrator/rag-pipeline"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">RAG Pipeline</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/orchestrator/session-management"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Session Management</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#search-lanes" class="table-of-contents__link toc-highlight">Search Lanes</a><ul><li><a href="#text-lane" class="table-of-contents__link toc-highlight">Text Lane</a></li><li><a href="#vector-lane" class="table-of-contents__link toc-highlight">Vector Lane</a></li><li><a href="#structured-memory-lane" class="table-of-contents__link toc-highlight">Structured Memory Lane</a></li><li><a href="#timeline-lane" class="table-of-contents__link toc-highlight">Timeline Lane</a></li></ul></li><li><a href="#reciprocal-rank-fusion-rrf" class="table-of-contents__link toc-highlight">Reciprocal Rank Fusion (RRF)</a></li><li><a href="#query-classification" class="table-of-contents__link toc-highlight">Query Classification</a></li><li><a href="#search-request" class="table-of-contents__link toc-highlight">Search Request</a><ul><li><a href="#search-modes" class="table-of-contents__link toc-highlight">Search Modes</a></li><li><a href="#frame-filtering" class="table-of-contents__link toc-highlight">Frame Filtering</a></li><li><a href="#structured-memory-options" class="table-of-contents__link toc-highlight">Structured Memory Options</a></li></ul></li><li><a href="#search-response" class="table-of-contents__link toc-highlight">Search Response</a><ul><li><a href="#ranking-diagnostics" class="table-of-contents__link toc-highlight">Ranking Diagnostics</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/architecture">Architecture</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/christopherkarani/Wax" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/christopherkarani/Wax/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Christopher Karani. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>