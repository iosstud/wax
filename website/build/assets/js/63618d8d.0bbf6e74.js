"use strict";(globalThis.webpackChunkwax_docs=globalThis.webpackChunkwax_docs||[]).push([[473],{825(e,r,t){t.r(r),t.d(r,{assets:()=>o,contentTitle:()=>c,default:()=>a,frontMatter:()=>d,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"media/photo-rag","title":"Photo RAG","description":"Build a semantic search layer over photo libraries with OCR, captions, and CLIP embeddings.","source":"@site/docs/media/photo-rag.md","sourceDirName":"media","slug":"/media/photo-rag","permalink":"/docs/media/photo-rag","draft":false,"unlisted":false,"editUrl":"https://github.com/christopherkarani/Wax/tree/main/website/docs/media/photo-rag.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Photo RAG","sidebar_label":"Photo RAG"},"sidebar":"docs","previous":{"title":"Session Management","permalink":"/docs/orchestrator/session-management"},"next":{"title":"Video RAG","permalink":"/docs/media/video-rag"}}');var n=t(4848),s=t(8453);const d={sidebar_position:1,title:"Photo RAG",sidebar_label:"Photo RAG"},c=void 0,o={},l=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Setup",id:"setup",level:2},{value:"Providers",id:"providers",level:3},{value:"Ingestion",id:"ingestion",level:2},{value:"From Photos Framework",id:"from-photos-framework",level:3},{value:"Metadata",id:"metadata",level:3},{value:"Querying",id:"querying",level:2},{value:"Configuration",id:"configuration",level:2}];function h(e){const r={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.p,{children:"Build a semantic search layer over photo libraries with OCR, captions, and CLIP embeddings."}),"\n",(0,n.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"PhotoRAGOrchestrator"})," provides retrieval-augmented generation for photo libraries. It ingests photos from the Photos framework or local files, extracts text (OCR), generates captions, computes embeddings, and enables natural-language queries over the photo collection."]}),"\n",(0,n.jsx)(r.h2,{id:"architecture",children:"Architecture"}),"\n",(0,n.jsx)(r.p,{children:"Each photo is represented as a hierarchy of frames:"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Frame Kind"}),(0,n.jsx)(r.th,{children:"Content"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"root"})}),(0,n.jsx)(r.td,{children:"Photo metadata (asset ID, capture date, camera, GPS)"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ocrBlock"})}),(0,n.jsx)(r.td,{children:"Individual OCR text blocks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ocrSummary"})}),(0,n.jsx)(r.td,{children:"Concatenated OCR text for the full image"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"captionShort"})}),(0,n.jsx)(r.td,{children:"Short image caption"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"tags"})}),(0,n.jsx)(r.td,{children:"Detected tags/labels"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"region"})}),(0,n.jsx)(r.td,{children:"Bounding box regions of interest"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"syncState"})}),(0,n.jsx)(r.td,{children:"Library sync checkpoint"})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"setup",children:"Setup"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-swift",children:"let orchestrator = try await PhotoRAGOrchestrator(\n    storeURL: storeURL,\n    config: PhotoRAGConfig(),\n    embedder: clipEmbedder,       // Multimodal embedding provider\n    ocr: myOCRProvider,           // Optional OCR provider\n    captioner: myCaptionProvider  // Optional caption provider\n)\n"})}),"\n",(0,n.jsx)(r.h3,{id:"providers",children:"Providers"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Embedder"})," \u2014 Any ",(0,n.jsx)(r.code,{children:"EmbeddingProvider"})," that works with image descriptions (e.g., CLIP-based)"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"OCR"})," \u2014 Extracts text from images (optional)"]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:"Captioner"})," \u2014 Generates natural-language descriptions of images (optional)"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"ingestion",children:"Ingestion"}),"\n",(0,n.jsx)(r.h3,{id:"from-photos-framework",children:"From Photos Framework"}),"\n",(0,n.jsx)(r.p,{children:"Sync and ingest from the user's photo library:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-swift",children:'// Sync library metadata\ntry await orchestrator.syncLibrary(scope: .all)\n\n// Ingest specific assets\ntry await orchestrator.ingest(assetIDs: ["asset-id-1", "asset-id-2"])\n'})}),"\n",(0,n.jsx)(r.h3,{id:"metadata",children:"Metadata"}),"\n",(0,n.jsx)(r.p,{children:"Each ingested photo stores rich metadata:"}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Key"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"assetID"})}),(0,n.jsx)(r.td,{children:"Photos library asset identifier"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"captureMs"})}),(0,n.jsx)(r.td,{children:"Capture timestamp in milliseconds"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"isLocal"})}),(0,n.jsx)(r.td,{children:"Whether the asset is available locally"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsxs)(r.td,{children:[(0,n.jsx)(r.code,{children:"lat"}),", ",(0,n.jsx)(r.code,{children:"lon"})]}),(0,n.jsx)(r.td,{children:"GPS coordinates"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"gpsAccuracyM"})}),(0,n.jsx)(r.td,{children:"GPS accuracy in meters"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsxs)(r.td,{children:[(0,n.jsx)(r.code,{children:"cameraMake"}),", ",(0,n.jsx)(r.code,{children:"cameraModel"})]}),(0,n.jsx)(r.td,{children:"Camera hardware"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"lensModel"})}),(0,n.jsx)(r.td,{children:"Lens identification"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsxs)(r.td,{children:[(0,n.jsx)(r.code,{children:"width"}),", ",(0,n.jsx)(r.code,{children:"height"})]}),(0,n.jsx)(r.td,{children:"Image dimensions"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"orientation"})}),(0,n.jsx)(r.td,{children:"EXIF orientation"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"pipelineVersion"})}),(0,n.jsx)(r.td,{children:"Ingestion pipeline version"})]})]})]}),"\n",(0,n.jsx)(r.h2,{id:"querying",children:"Querying"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-swift",children:'let context = try await orchestrator.recall(PhotoQuery(\n    text: "photos with handwritten notes",\n    topK: 10\n))\n\nfor item in context.items {\n    print("Asset: \\(item.assetID), Score: \\(item.score)")\n    print("OCR text: \\(item.ocrText ?? "none")")\n}\n'})}),"\n",(0,n.jsx)(r.p,{children:"The query pipeline:"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsx)(r.li,{children:"Embeds the query text"}),"\n",(0,n.jsx)(r.li,{children:"Searches across OCR text (BM25) and image embeddings (vector similarity)"}),"\n",(0,n.jsx)(r.li,{children:"Fuses results with RRF"}),"\n",(0,n.jsx)(r.li,{children:"Returns ranked photos with surrogates and pixel payloads"}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"configuration",children:"Configuration"}),"\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.code,{children:"PhotoRAGConfig"})," controls ingestion and search:"]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Parameter"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"thumbnailSize"})}),(0,n.jsx)(r.td,{children:"Pixel size for thumbnail extraction"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"fullSize"})}),(0,n.jsx)(r.td,{children:"Pixel size for full-resolution extraction"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"enableOCR"})}),(0,n.jsx)(r.td,{children:"Whether to run OCR on ingested photos"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"enableRegions"})}),(0,n.jsx)(r.td,{children:"Whether to extract bounding box regions"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ingestConcurrency"})}),(0,n.jsx)(r.td,{children:"Parallel ingestion tasks"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"vectorEnginePreference"})}),(0,n.jsx)(r.td,{children:"CPU vs GPU vector engine"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"hybridAlpha"})}),(0,n.jsx)(r.td,{children:"BM25 vs vector blend (0 = vector, 1 = text)"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"searchTopK"})}),(0,n.jsx)(r.td,{children:"Candidates to retrieve"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"requireOnDeviceProviders"})}),(0,n.jsx)(r.td,{children:"Reject network-dependent providers"})]})]})]})]})}function a(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453(e,r,t){t.d(r,{R:()=>d,x:()=>c});var i=t(6540);const n={},s=i.createContext(n);function d(e){const r=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),i.createElement(s.Provider,{value:r},e.children)}}}]);