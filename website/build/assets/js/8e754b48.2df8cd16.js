"use strict";(globalThis.webpackChunkwax_docs=globalThis.webpackChunkwax_docs||[]).push([[428],{9364(e,t,n){n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"core/structured-memory","title":"Structured Memory","description":"Store and query knowledge as an entity-fact-predicate graph with bitemporal semantics.","source":"@site/docs/core/structured-memory.md","sourceDirName":"core","slug":"/core/structured-memory","permalink":"/docs/core/structured-memory","draft":false,"unlisted":false,"editUrl":"https://github.com/christopherkarani/Wax/tree/main/website/docs/core/structured-memory.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Structured Memory","sidebar_label":"Structured Memory"},"sidebar":"docs","previous":{"title":"WAL & Crash Recovery","permalink":"/docs/core/wal-crash-recovery"},"next":{"title":"Concurrency Model","permalink":"/docs/core/concurrency-model"}}');var i=n(4848),s=n(8453);const c={sidebar_position:4,title:"Structured Memory",sidebar_label:"Structured Memory"},d=void 0,a={},l=[{value:"Overview",id:"overview",level:2},{value:"Entity-Fact Model",id:"entity-fact-model",level:2},{value:"Entities",id:"entities",level:3},{value:"Predicates",id:"predicates",level:3},{value:"Fact Values",id:"fact-values",level:3},{value:"Bitemporal Queries",id:"bitemporal-queries",level:2},{value:"Evidence Provenance",id:"evidence-provenance",level:2},{value:"Deduplication",id:"deduplication",level:2},{value:"Retraction",id:"retraction",level:2}];function o(e){const t={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Store and query knowledge as an entity-fact-predicate graph with bitemporal semantics."}),"\n",(0,i.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(t.p,{children:["WaxCore's structured memory system models knowledge as RDF-like triples: ",(0,i.jsx)(t.strong,{children:"(subject, predicate, object)"}),". Each fact carries two temporal dimensions \u2014 ",(0,i.jsx)(t.strong,{children:"valid time"})," (when the fact is semantically true) and ",(0,i.jsx)(t.strong,{children:"system time"})," (when the fact was recorded) \u2014 enabling point-in-time queries."]}),"\n",(0,i.jsxs)(t.p,{children:["The structured memory types defined here are used by the WaxTextSearch module's ",(0,i.jsx)(t.code,{children:"FTS5SearchEngine"})," actor for storage and querying."]}),"\n",(0,i.jsx)(t.h2,{id:"entity-fact-model",children:"Entity-Fact Model"}),"\n",(0,i.jsx)(t.h3,{id:"entities",children:"Entities"}),"\n",(0,i.jsxs)(t.p,{children:["An ",(0,i.jsx)(t.code,{children:"EntityKey"})," is an open-world string identifier for any named concept:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-swift",children:'let alice = EntityKey("alice")\nlet acme = EntityKey("company:acme")\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Entities have a ",(0,i.jsx)(t.strong,{children:"kind"}),' (e.g., "Person", "Organization") and zero or more ',(0,i.jsx)(t.strong,{children:"aliases"})," for fuzzy matching. Aliases are NFKC-normalized and case-folded for consistent lookup."]}),"\n",(0,i.jsx)(t.h3,{id:"predicates",children:"Predicates"}),"\n",(0,i.jsxs)(t.p,{children:["A ",(0,i.jsx)(t.code,{children:"PredicateKey"})," names a relationship or property:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-swift",children:'let worksAt = PredicateKey("works_at")\nlet founded = PredicateKey("founded_year")\n'})}),"\n",(0,i.jsx)(t.h3,{id:"fact-values",children:"Fact Values"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"FactValue"})," enum supports seven typed values:"]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Case"}),(0,i.jsx)(t.th,{children:"Description"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:".string(String)"})}),(0,i.jsx)(t.td,{children:"Text value"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:".int(Int64)"})}),(0,i.jsx)(t.td,{children:"Integer value"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:".double(Double)"})}),(0,i.jsx)(t.td,{children:"Floating-point value (must be finite)"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:".bool(Bool)"})}),(0,i.jsx)(t.td,{children:"Boolean value"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:".data(Data)"})}),(0,i.jsx)(t.td,{children:"Binary blob"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:".timeMs(Int64)"})}),(0,i.jsx)(t.td,{children:"Timestamp in milliseconds"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:".entity(EntityKey)"})}),(0,i.jsx)(t.td,{children:"Reference to another entity"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"bitemporal-queries",children:"Bitemporal Queries"}),"\n",(0,i.jsxs)(t.p,{children:["Every fact has two time ranges defined by ",(0,i.jsx)(t.code,{children:"StructuredTimeRange"}),":"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Valid time"})," ",(0,i.jsx)(t.code,{children:"[fromMs, toMs)"})," \u2014 When the fact is true in the real world"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"System time"})," ",(0,i.jsx)(t.code,{children:"[fromMs, toMs)"})," \u2014 When the fact was asserted in the system"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Use ",(0,i.jsx)(t.code,{children:"StructuredMemoryAsOf"})," to query facts at specific points in both time dimensions. A fact matches when the query's system time falls within the system range AND the query's valid time falls within the valid range."]}),"\n",(0,i.jsxs)(t.p,{children:["Open-ended ranges (where ",(0,i.jsx)(t.code,{children:"toMs"})," is ",(0,i.jsx)(t.code,{children:"nil"}),") represent facts that remain true indefinitely until retracted."]}),"\n",(0,i.jsx)(t.h2,{id:"evidence-provenance",children:"Evidence Provenance"}),"\n",(0,i.jsxs)(t.p,{children:["Each fact is linked to its source via ",(0,i.jsx)(t.code,{children:"StructuredEvidence"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-swift",children:'StructuredEvidence(\n    sourceFrameId: frameId,\n    chunkIndex: 2,\n    spanUTF8: 100..<250,\n    extractorId: "nlp-v1",\n    extractorVersion: "1.0",\n    confidence: 0.95,\n    assertedAtMs: timestamp\n)\n'})}),"\n",(0,i.jsx)(t.p,{children:"This provenance chain allows tracing any fact back to the exact text span that produced it."}),"\n",(0,i.jsx)(t.h2,{id:"deduplication",children:"Deduplication"}),"\n",(0,i.jsxs)(t.p,{children:["Facts are deduplicated by a SHA-256 hash of (subject, predicate, object). Asserting the same triple twice returns the existing ",(0,i.jsx)(t.code,{children:"FactRowID"})," rather than creating a duplicate."]}),"\n",(0,i.jsx)(t.h2,{id:"retraction",children:"Retraction"}),"\n",(0,i.jsx)(t.p,{children:"Facts can be retracted by closing their system time range:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-swift",children:"try await engine.retractFact(factId: factId, atMs: nowMs)\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Retraction only affects open-ended spans (where ",(0,i.jsx)(t.code,{children:"system_to_ms"})," is NULL). Retracting an already-closed span is a no-op."]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,t,n){n.d(t,{R:()=>c,x:()=>d});var r=n(6540);const i={},s=r.createContext(i);function c(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);