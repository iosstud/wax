"use strict";(globalThis.webpackChunkwax_docs=globalThis.webpackChunkwax_docs||[]).push([[889],{1453(e,r,n){n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"orchestrator/memory-orchestrator","title":"Memory Orchestrator","description":"Configure and use the primary text RAG orchestrator for ingestion and retrieval.","source":"@site/docs/orchestrator/memory-orchestrator.md","sourceDirName":"orchestrator","slug":"/orchestrator/memory-orchestrator","permalink":"/docs/orchestrator/memory-orchestrator","draft":false,"unlisted":false,"editUrl":"https://github.com/christopherkarani/Wax/tree/main/website/docs/orchestrator/memory-orchestrator.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Memory Orchestrator","sidebar_label":"Memory Orchestrator"},"sidebar":"docs","previous":{"title":"Architecture","permalink":"/docs/architecture"},"next":{"title":"RAG Pipeline","permalink":"/docs/orchestrator/rag-pipeline"}}');var i=n(4848),s=n(8453);const c={sidebar_position:1,title:"Memory Orchestrator",sidebar_label:"Memory Orchestrator"},d=void 0,a={},o=[{value:"Overview",id:"overview",level:2},{value:"Initialization",id:"initialization",level:2},{value:"Ingestion Pipeline",id:"ingestion-pipeline",level:2},{value:"Batching",id:"batching",level:3},{value:"Embedding Cache",id:"embedding-cache",level:3},{value:"Recall",id:"recall",level:2},{value:"Embedding Policies",id:"embedding-policies",level:3},{value:"Frame Filtering",id:"frame-filtering",level:3},{value:"Direct Search",id:"direct-search",level:2},{value:"Structured Memory",id:"structured-memory",level:2},{value:"Session Handoffs",id:"session-handoffs",level:2},{value:"Runtime Statistics",id:"runtime-statistics",level:2},{value:"Configuration Reference",id:"configuration-reference",level:2}];function l(e){const r={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.p,{children:"Configure and use the primary text RAG orchestrator for ingestion and retrieval."}),"\n",(0,i.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"MemoryOrchestrator"})," is the main entry point for text-based memory applications. It coordinates chunking, embedding, indexing, search, and RAG context assembly into a single actor with a high-level API."]}),"\n",(0,i.jsx)(r.h2,{id:"initialization",children:"Initialization"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-swift",children:"let orchestrator = try await MemoryOrchestrator(\n    at: storeURL,\n    config: config,\n    embedder: embedder  // nil for text-only mode\n)\n"})}),"\n",(0,i.jsxs)(r.p,{children:["The orchestrator creates a new ",(0,i.jsx)(r.code,{children:".mv2s"})," file if one doesn't exist at the URL, or opens an existing one with automatic crash recovery."]}),"\n",(0,i.jsx)(r.h2,{id:"ingestion-pipeline",children:"Ingestion Pipeline"}),"\n",(0,i.jsxs)(r.p,{children:["When you call ",(0,i.jsx)(r.code,{children:"MemoryOrchestrator/remember(_:metadata:)"}),", the orchestrator:"]}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Chunks"})," the text using the configured chunking strategy (default: token-count with 400 tokens and 40-token overlap)"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Embeds"})," each chunk using the embedding provider (if provided), batching through ",(0,i.jsx)(r.code,{children:"BatchEmbeddingProvider"})," when available"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Writes"})," each chunk as a frame to the ",(0,i.jsx)(r.code,{children:".mv2s"})," file"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Indexes"})," each chunk's text in the FTS5 full-text search engine"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Adds"})," each chunk's embedding to the vector search engine"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Commits"})," all changes atomically"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"batching",children:"Batching"}),"\n",(0,i.jsx)(r.p,{children:"Ingestion respects two config parameters:"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Parameter"}),(0,i.jsx)(r.th,{children:"Default"}),(0,i.jsx)(r.th,{children:"Purpose"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"ingestBatchSize"})}),(0,i.jsx)(r.td,{children:"32"}),(0,i.jsx)(r.td,{children:"Chunks per commit batch"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"ingestConcurrency"})}),(0,i.jsx)(r.td,{children:"1"}),(0,i.jsx)(r.td,{children:"Parallel embedding tasks"})]})]})]}),"\n",(0,i.jsx)(r.h3,{id:"embedding-cache",children:"Embedding Cache"}),"\n",(0,i.jsx)(r.p,{children:"A bounded LRU cache (default capacity: 2,048) avoids re-embedding identical text within a session."}),"\n",(0,i.jsx)(r.h2,{id:"recall",children:"Recall"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"MemoryOrchestrator/recall(query:)"})," returns a ",(0,i.jsx)(r.code,{children:"RAGContext"})," assembled within the configured token budget:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-swift",children:'let context = try await orchestrator.recall(query: "project timeline")\n'})}),"\n",(0,i.jsx)(r.h3,{id:"embedding-policies",children:"Embedding Policies"}),"\n",(0,i.jsx)(r.p,{children:"Control when query embeddings are computed:"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Policy"}),(0,i.jsx)(r.th,{children:"Behavior"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:".never"})}),(0,i.jsx)(r.td,{children:"Text-only search (no vector lane)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:".ifAvailable"})}),(0,i.jsx)(r.td,{children:"Use vector search if an embedder is configured"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:".always"})}),(0,i.jsx)(r.td,{children:"Require vector search; throw if no embedder"})]})]})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-swift",children:'let context = try await orchestrator.recall(\n    query: "timeline",\n    embeddingPolicy: .ifAvailable\n)\n'})}),"\n",(0,i.jsx)(r.h3,{id:"frame-filtering",children:"Frame Filtering"}),"\n",(0,i.jsx)(r.p,{children:"Restrict recall to specific frames:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-swift",children:'let context = try await orchestrator.recall(\n    query: "meeting notes",\n    frameFilter: FrameFilter(\n        requiredTags: ["meetings"],\n        timeRange: TimeRange(after: weekAgoMs)\n    )\n)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"direct-search",children:"Direct Search"}),"\n",(0,i.jsxs)(r.p,{children:["For raw search results without RAG assembly, use ",(0,i.jsx)(r.code,{children:"MemoryOrchestrator/search(query:mode:topK:frameFilter:)"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-swift",children:'let hits = try await orchestrator.search(\n    query: "velocity",\n    mode: .hybrid(alpha: 0.5),\n    topK: 20\n)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"structured-memory",children:"Structured Memory"}),"\n",(0,i.jsxs)(r.p,{children:["When ",(0,i.jsx)(r.code,{children:"enableStructuredMemory"})," is set in the config:"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-swift",children:'// Entities\ntry await orchestrator.upsertEntity(\n    key: EntityKey("alice"),\n    kind: "Person",\n    aliases: ["Alice Smith"]\n)\n\n// Facts\ntry await orchestrator.assertFact(\n    subject: EntityKey("alice"),\n    predicate: PredicateKey("role"),\n    object: .string("Engineering Lead"),\n    evidence: [...]\n)\n\n// Queries\nlet facts = try await orchestrator.facts(\n    about: EntityKey("alice"),\n    predicate: nil,\n    asOfMs: nowMs\n)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"session-handoffs",children:"Session Handoffs"}),"\n",(0,i.jsx)(r.p,{children:"Store and retrieve cross-session handoff records:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-swift",children:'// Save handoff at session end\ntry await orchestrator.rememberHandoff(\n    content: "Current project state summary...",\n    project: "my-app",\n    pendingTasks: ["Fix login bug", "Add dark mode"],\n    sessionId: sessionId\n)\n\n// Retrieve at next session start\nif let handoff = try await orchestrator.latestHandoff(project: "my-app") {\n    print(handoff.content)\n    print(handoff.pendingTasks)\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"runtime-statistics",children:"Runtime Statistics"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-swift",children:'let stats = try await orchestrator.runtimeStats()\nprint("Frames: \\(stats.frameCount)")\nprint("Vector search: \\(stats.vectorSearchEnabled)")\nprint("Embedder: \\(stats.embedderIdentity?.model ?? "none")")\n'})}),"\n",(0,i.jsx)(r.h2,{id:"configuration-reference",children:"Configuration Reference"}),"\n",(0,i.jsxs)(r.p,{children:["See ",(0,i.jsx)(r.code,{children:"OrchestratorConfig"})," for the full configuration surface:"]}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Category"}),(0,i.jsx)(r.th,{children:"Key Options"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Search"}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"enableTextSearch"}),", ",(0,i.jsx)(r.code,{children:"enableVectorSearch"}),", ",(0,i.jsx)(r.code,{children:"enableStructuredMemory"})]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"RAG"}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"ragConfig"})," (",(0,i.jsx)(r.code,{children:"FastRAGConfig"}),")"]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Chunking"}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"chunking"})," (",(0,i.jsx)(r.code,{children:"ChunkingStrategy"}),")"]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Embedding"}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"embeddingCacheCapacity"}),", ",(0,i.jsx)(r.code,{children:"requireOnDeviceProviders"})]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Vector"}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"useMetalVectorSearch"}),", ",(0,i.jsx)(r.code,{children:"vectorEnginePreference"})]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Maintenance"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.code,{children:"liveSetRewriteSchedule"})})]})]})]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453(e,r,n){n.d(r,{R:()=>c,x:()=>d});var t=n(6540);const i={},s=t.createContext(i);function c(e){const r=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);